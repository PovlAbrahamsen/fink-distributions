Handle macOS 11 and later properly. Based on patch in libtool port.
--- a/configure.orig	2021-10-27 12:30:23.000000000 -0400
+++ b/configure	2021-10-27 12:37:51.000000000 -0400
@@ -9211,9 +9211,9 @@
       case ${MACOSX_DEPLOYMENT_TARGET-10.0},$host in
 	10.0,*86*-darwin8*|10.0,*-darwin[91]*)
 	  _lt_dar_allow_undefined='$wl-undefined ${wl}dynamic_lookup' ;;
-	10.[012][,.]*)
+	10.[012][,.]*|,*powerpc*)
 	  _lt_dar_allow_undefined='$wl-flat_namespace $wl-undefined ${wl}suppress' ;;
-	10.*)
+	*)
 	  _lt_dar_allow_undefined='$wl-undefined ${wl}dynamic_lookup' ;;
       esac
     ;;
@@ -14978,6 +14978,7 @@
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
+#include <stdlib.h>
 #include <ctype.h>
 #ifndef HAVE_EBCDIC
 #	define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
@@ -20854,6 +20855,7 @@
 
 #include <sys/types.h>
 #include <sys/time.h>
+#include <stdlib.h>
 #include <unistd.h>
 #include <pthread.h>
 #ifndef NULL
@@ -23241,6 +23243,7 @@
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
+#include <stdlib.h>
 #include <ctype.h>
 main()
 {
--- a/build/ltmain.sh.orig	2021-10-25 13:06:00.000000000 -0400
+++ b/build/ltmain.sh	2021-10-27 12:17:55.000000000 -0400
@@ -8140,7 +8140,7 @@
 	  *)
 	    if test no = "$installed"; then
 	      func_append notinst_deplibs " $lib"
-	      need_relink=yes
+	      need_relink=no
 	    fi
 	    ;;
 	  esac
--- a/tests/scripts/functions.sh.orig	2022-08-03 10:11:26.000000000 -0400
+++ b/tests/scripts/functions.sh	2022-08-03 10:11:37.000000000 -0400
@@ -15,6 +15,6 @@
 
 timer() {
 	if [ -n "$STARTTIME" ]; then
-		date -u -d "now - $STARTTIME sec" +%T
+		gdate -u -d "now - $STARTTIME sec" +%T
 	fi
 }
