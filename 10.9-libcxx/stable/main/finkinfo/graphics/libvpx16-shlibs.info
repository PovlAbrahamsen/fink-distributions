# -*- coding: ascii; tab-width: 4 -*-
Package: libvpx16-shlibs
Version: 1.6.1
Revision: 2
Description: WebM VP8/VP9 Codec SDK
DescPackaging: <<
	Starting with libvpx16 we now build a shared lib.
<<
License: BSD
Homepage: https://www.webmproject.org/
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>

Source: http://storage.googleapis.com/downloads.webmproject.org/releases/webm/libvpx-%v.tar.bz2
Source-Checksum: SHA256(1c2c0c2a97fba9474943be34ee39337dee756780fc12870ba1dc68372586a819)

PatchScript: <<
	%{default_script}
	perl -pi -e 's/-isysroot \${osx_sdk_dir}//g' build/make/configure.sh
<<

BuildDepends: yasm, grep

SetMAKEFLAGS: V=1
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
SetLDFLAGS: -Wl,-install_name,%p/lib/libvpx.4.dylib

# <=10.9 doesn't have the tuple header.
ConfigureParams: <<
	--target=%m-darwin${version}-gcc \
	--extra-cflags="-DGTEST_USE_OWN_TR1_TUPLE=1" \
	--enable-shared \
	--disable-static \
	--disable-unit-tests
<<

CompileScript: <<
	#!/bin/bash -ev
	let version=`uname -r | cut -d . -f 1`
	if [ ${version} -gt 15 ]; then
		version=15
	fi
	%{default_script}
<<

# Test requires downloading files.
#InfoTest: TestScript: make test || exit 2

InstallScript: <<
	make install DESTDIR=%d
<<
Shlibs: %p/lib/libvpx.4.dylib 1.0.0 %n (>= 1.6.1-1)
DocFiles: AUTHORS CHANGELOG LICENSE README PATENTS

SplitOff: <<
	Package: libvpx16
	Depends: libvpx16-shlibs (= %v-%r)
	Conflicts: libvpx, libvpx14, libvpx15, libvpx16, libvpx8
	Replaces: libvpx, libvpx14, libvpx15, libvpx16, libvpx8
	BuildDependsOnly: true
	Files: <<
		include
		lib/pkgconfig
		lib/libvpx.dylib
	<<
	DocFiles: AUTHORS CHANGELOG LICENSE README PATENTS
<<
SplitOff2: <<
	Package: libvpx-bin
	Depends: libvpx16-shlibs (>= %v-%r)
	Files: bin
	DocFiles: AUTHORS CHANGELOG LICENSE README PATENTS
<<
