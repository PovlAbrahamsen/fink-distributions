Package: lighttpd
Version: 1.4.71
Revision: 1
DocFiles: AUTHORS COPYING NEWS README
Description: Lightning fast web server
License: BSD
Maintainer: Alexey Zakhlestin <indeyets@gmail.com>
HomePage: https://lighttpd.net

BuildDepends: <<
  autoconf2.6,
  automake1.15,
  cyrus-sasl2.3-dev,
  fink (>= 0.32),
  fink-package-precedence,
  libmaxminddb-dev,
  libpcre2,
  libtool2,
  libxml2 (>= 2.9.1-1),
  lua51-dev,
  mysql-unified-dev,
  openldap2-dev,
  openssl300-dev,
  pkgconfig,
  sqlite3-dev
<<
Depends: daemonic, libpcre2-shlibs, openssl300-shlibs
Provides: httpd
Recommends: lighttpd-access, lighttpd-accesslog

Source: https://download.lighttpd.net/lighttpd/releases-1.4.x/lighttpd-%v.tar.xz
Source-Checksum: SHA256(b8b6915da20396fdc354df3324d5e440169b2e5ea7859e3a775213841325afac)

PatchFile: %n.patch
PatchFile-MD5: cd3d98f5d61e581171f1e51a7ba51dce
PatchScript: <<
  cat %{PatchFile} | sed 's|@PREFIX@|%p|g' | patch -p1
  glibtoolize --copy --force
  autoreconf -fi
<<

ConfigureParams: <<
	--libdir='${prefix}/lib/%n' \
	--with-openssl=%p \
	--with-ldap \
	--with-mysql=%p/bin/mysql_config \
	--enable-dependency-tracking \
	--with-pcre2 \
	--with-webdav-props \
	--without-webdav-locks \
	--with-lua \
	--with-maxminddb
<<
CompileScript: <<
	./configure %c
	make
	fink-package-precedence .
<<
InstallScript: <<
 mkdir -p %i/etc/%n
 mkdir -p %i/etc/%n/mods-enabled
 mkdir -p %i/var/log/%n
 mkdir -p %i/share/doc/%n
 mkdir -p %i/share/man/man1
 mkdir -p %i/sbin
 mkdir -p %i/bin
 cp -R fink/etc/* %i/etc/lighttpd/
 cp -R doc %i/share/doc/%n
 make install prefix=%i
 rm -f %i/lib/%n/mod_*.la
 rm -f %i/share/doc/%n/doc/*.1 %i/share/doc/%n/doc/Makefile*
<<
ConfFiles: %p/etc/lighttpd/lighttpd.conf
Shlibs: <<
  %p/lib/lighttpd/liblightcomp.dylib 0.0.0 lighttpd (>= 1.4.16-1) 32
<<
DaemonicName: %n
DaemonicFile: <<
<service>
	<description>Lighttpd web server</description>
	<message>Lighttpd %v</message>

	<daemon name="%n">
		<executable background="yes">%p/sbin/lighttpd</executable>
		<parameters>-f %p/etc/%n/lighttpd.conf</parameters>
		<configfile>%p/etc/%n/lighttpd.conf</configfile>
		<pidfile>%p/var/run/%n.pid</pidfile>
	</daemon>
</service>
<<

PostInstScript: <<
set +e
if [ "$1" = "configure" ]; then
  chown www:www %p/var/log/%n
  %p/bin/daemonic install %n
fi

if [ "$1" = "upgrade" ]; then
  %p/bin/daemonic update %n
fi

%p/bin/daemonic enable %n

if [ -f %p/var/run/%n.pid ]; then
  echo "Stopping %n"
  killall %n 2>/dev/null
  echo "Starting %n"
  %p/sbin/lighttpd -f %p/etc/%n/lighttpd.conf
fi
<<

PreRmScript: <<
set +e
if [ "$1" != "upgrade" ]; then
  if [ -f %p/var/run/%n.pid ]; then
    echo "Stopping %n"
    killall %n 2>/dev/null
  fi

	%p/bin/daemonic disable %n
fi
<<

DescDetail: <<
lighttpd (pronounced /lighty/) is a secure, fast, compliant, and very flexible
web server that has been optimized for high-performance environments. lighttpd
uses memory and CPU efficiently and has lower resource use than other popular
web servers. Its advanced feature-set (FastCGI, CGI, Auth, Output-Compression,
URL-Rewriting and much more) make lighttpd the perfect web server for all
systems, small and large.
<<
DescPackaging: <<
liblightcomp.dylib is a private library only.
<<

# SplitOffs follow

SplitOff: <<
  Package: lighttpd-access
  Depends: %N (=%v-%r)
  Description: Plugin: mod_access
  Files: <<
    share/doc/%N/doc/access.txt
    etc/%N/mods-available/access.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/access.conf
<<

SplitOff2: <<
  Package: lighttpd-accesslog
  Depends: %N (=%v-%r)
  Description: Plugin: mod_accesslog
  Files: <<
    lib/%N/mod_accesslog.so
    share/doc/%N/doc/accesslog.txt
    etc/%N/mods-available/accesslog.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/accesslog.conf
<<

SplitOff3: <<
  Package: lighttpd-alias
  Depends: %N (=%v-%r)
  Description: Plugin: mod_alias
  Files: <<
    share/doc/%N/doc/alias.txt
    etc/%N/mods-available/alias.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/alias.conf
<<

SplitOff4: <<
  Package: lighttpd-auth
  Depends: %N (=%v-%r), openldap2-shlibs
  Description: Plugin: mod_auth
  Files: <<
    lib/%N/mod_auth.so
    share/doc/%N/doc/authentication.txt
    etc/%N/mods-available/auth.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/auth.conf
<<

SplitOff5: <<
  Package: lighttpd-cgi
  Depends: %N (=%v-%r)
  Description: Plugin: mod_cgi
  Files: <<
    lib/%N/mod_cgi.so
    share/doc/%N/doc/cgi.txt
    etc/%N/mods-available/cgi.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/cgi.conf
<<

SplitOff6: <<
  Package: lighttpd-cml
  Conflicts: lighttpd (>= 1.4.64)
  Description: OBSOLETE: use lighttpd-magnet instead
  DescDetail: <<
    Cache Meta Language
  <<
  Files: <<
    lib/%N/mod_cml.so
    share/doc/%N/doc/cml.txt
    etc/%N/mods-available/cml.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/cml.conf
<<

SplitOff7: <<
  Package: lighttpd-compress
  Conflicts: lighttpd (>= 1.4.56)
  Description: OBSOLETE: use lighttpd-deflate instead
  RuntimeDepends: <<
     fink-obsolete-packages,
     lighttpd-deflate (>= %v-%r)
  <<
  Files: <<
    lib/%N/mod_compress.so
    share/doc/%N/doc/compress.txt
    etc/%N/mods-available/compress.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/compress.conf
<<

SplitOff8: <<
  Package: lighttpd-evhost
  Depends: %N (=%v-%r)
  Description: Plugin: mod_evhost
  DescDetail: <<
    Enchanced Virtual Host support
  <<
  Files: <<
    share/doc/%N/doc/evhost.txt
    etc/%N/mods-available/evhost.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/evhost.conf
<<

SplitOff9: <<
  Package: lighttpd-expire
  Depends: %N (=%v-%r)
  Description: Plugin: mod_expire
  Files: <<
    share/doc/%N/doc/expire.txt
    etc/%N/mods-available/expire.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/expire.conf
<<

SplitOff10: <<
  Package: lighttpd-fastcgi
  Depends: %N (=%v-%r)
  Description: Plugin: mod_fastcgi
  Files: <<
    share/doc/%N/doc/fastcgi.txt
    share/doc/%N/doc/fastcgi-state.dot
    share/doc/%N/doc/fastcgi-state.txt
    etc/%N/mods-available/fastcgi.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/fastcgi.conf
<<

SplitOff11: <<
  Package: lighttpd-proxy
  Depends: %N (=%v-%r)
  Description: Plugin: mod_proxy
  Files: <<
    lib/%N/mod_proxy.so
    share/doc/%N/doc/proxy.txt
    etc/%N/mods-available/proxy.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/proxy.conf
<<

SplitOff12: <<
  Package: lighttpd-redirect
  Depends: %N (=%v-%r)
  Description: Plugin: mod_redirect
  Files: <<
    share/doc/%N/doc/redirect.txt
    etc/%N/mods-available/redirect.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/redirect.conf
<<

SplitOff13: <<
  Package: lighttpd-rewrite
  Depends: %N (=%v-%r)
  Description: Plugin: mod_rewrite
  Files: <<
    share/doc/%N/doc/rewrite.txt
    etc/%N/mods-available/rewrite.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/rewrite.conf
<<

SplitOff14: <<
  Package: lighttpd-rrdtool
  Depends: %N (=%v-%r), rrdtool
  Description: Plugin: mod_rrdtool
  DescDetail: <<
    Logging into Round Robin Database
  <<
  Files: <<
    lib/%N/mod_rrdtool.so
    share/doc/%N/doc/rrdtool.txt
    share/doc/%N/doc/rrdtool-graph.sh
    etc/%N/mods-available/rrdtool.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/rrdtool.conf
<<

SplitOff15: <<
  Package: lighttpd-secdownload
  Conflicts: lighttpd (>= 1.4.68)
  Description: OBSOLETE: use lighttpd-magnet instead
  DescDetail: <<
    Secure Download
  <<
  Files: <<
    lib/%N/mod_secdownload.so
    share/doc/%N/doc/secdownload.txt
    etc/%N/mods-available/secdownload.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/secdownload.conf
<<

SplitOff16: <<
  Package: lighttpd-setenv
  Depends: %N (=%v-%r)
  Description: Plugin: mod_setenv
  Files: <<
    share/doc/%N/doc/setenv.txt
    etc/%N/mods-available/setenv.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/setenv.conf
<<

SplitOff17: <<
  Package: lighttpd-simple-vhost
  Depends: %N (=%v-%r)
  Description: Plugin: mod_simple_vhost
  Files: <<
    share/doc/%N/doc/simple-vhost.txt
    etc/%N/mods-available/simple_vhost.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/simple_vhost.conf
<<

SplitOff18: <<
  Package: lighttpd-ssi
  Depends: %N (=%v-%r)
  Description: Plugin: mod_ssi
  Files: <<
    lib/%N/mod_ssi.so
    share/doc/%N/doc/ssi.txt
    etc/%N/mods-available/ssi.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/ssi.conf
<<

SplitOff19: <<
  Package: lighttpd-status
  Depends: %N (=%v-%r)
  Description: Plugin: mod_status
  Files: <<
    lib/%N/mod_status.so
    share/doc/%N/doc/status.txt
    etc/%N/mods-available/status.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/status.conf
<<

SplitOff20: <<
  Package: lighttpd-trigger-b4dl
  Conflicts: lighttpd (>= 1.4.64)
  Description: OBSOLETE: use lighttpd-magnet instead
  DescDetail: <<
    Trigger before download
  <<
  Files: <<
    lib/%N/mod_trigger_b4_dl.so
    share/doc/%N/doc/trigger_b4_dl.txt
    etc/%N/mods-available/trigger_b4_dl.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/trigger_b4_dl.conf
<<

SplitOff21: <<
  Package: lighttpd-userdir
  Depends: %N (=%v-%r)
  Description: Plugin: mod_userdir
  Files: <<
    lib/%N/mod_userdir.so
    share/doc/%N/doc/userdir.txt
    etc/%N/mods-available/userdir.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/userdir.conf
<<

SplitOff22: <<
  Package: lighttpd-usertrack
  Conflicts: lighttpd (>= 1.4.68)
  Description: OBSOLETE: use lighttpd-magnet instead
  DescDetail: <<
    Cookies
  <<
  Files: <<
    lib/%N/mod_usertrack.so
    etc/%N/mods-available/usertrack.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/usertrack.conf
<<

SplitOff23: <<
  Package: lighttpd-evasive
  Conflicts: lighttpd (>= 1.4.68)
  Description: OBSOLETE: use lighttpd-magnet instead
  DescDetail: <<
    Limit of connections per ip
  <<
  Files: <<
    lib/%N/mod_evasive.so
    etc/%N/mods-available/evasive.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/evasive.conf
<<

SplitOff24: <<
  Package: lighttpd-flv-streaming
  Conflicts: lighttpd (>= 1.4.64)
  Description: OBSOLETE: use lighttpd-magnet instead
  DescDetail: <<
    Flash Video
  <<
  Files: <<
    lib/%N/mod_flv_streaming.so
    etc/%N/mods-available/flv_streaming.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/flv_streaming.conf
<<

SplitOff25: <<
  Package: lighttpd-magnet
  Depends: %N (=%v-%r), lua51-shlibs
  Description: Plugin: mod_magnet
  DescDetail: <<
    Control the request handling
  <<
  Files: <<
    lib/%N/mod_magnet.so
    share/doc/%N/doc/magnet.txt
    etc/%N/mods-available/magnet.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/magnet.conf
<<

SplitOff26: <<
  Package: lighttpd-mysql-vhost
  Conflicts: lighttpd (>= 1.4.64)
  Description: OBSOLETE: use lighttpd-vhostdb-mysql instead
  Files: <<
    lib/%N/mod_mysql_vhost.so
    share/doc/%N/doc/mysqlvhost.txt
    etc/%N/mods-available/mysql_vhost.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/mysql_vhost.conf
<<

SplitOff27: <<
  Package: lighttpd-scgi
  Depends: %N (=%v-%r)
  Description: Plugin: mod_scgi
  Files: <<
    share/doc/%N/doc/scgi.txt
    etc/%N/mods-available/scgi.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/scgi.conf
<<

SplitOff28: <<
  Package: lighttpd-webdav
  Depends: %N (=%v-%r), libxml2-shlibs (>= 2.9.1-1), sqlite3-shlibs
  Description: Plugin: mod_webdav
  Files: <<
    lib/%N/mod_webdav.so
    share/doc/%N/doc/webdav.txt
    etc/%N/mods-available/webdav.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/webdav.conf
<<

SplitOff29: <<
  Package: lighttpd-geoip
  Conflicts: lighttpd (>= 1.4.64)
  Description: OBSOLETE: use lighttpd-maxminddb instead
  RuntimeDepends: <<
     fink-obsolete-packages,
     lighttpd-maxminddb (>= %v-%r)
  <<
  Files: <<
    lib/%N/mod_geoip.so
    etc/%N/mods-available/geoip.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/geoip.conf
<<

SplitOff30: <<
  Package: lighttpd-extforward
  Depends: %N (=%v-%r)
  Description: Plugin: mod_extforward
  DescDetail: <<
    Get real ip from X-Forwarded-For
  <<
  Files: <<
    lib/%N/mod_extforward.so
    etc/%N/mods-available/extforward.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/extforward.conf
<<

SplitOff31: <<
  Package: lighttpd-useronline
  Conflicts: lighttpd (>= 1.4.56)
  Description: OBSOLETE: use lighttpd-magnet instead
  DescDetail: <<
    Track online/active users by unique IPs
    Note: This is an *UNOFFICIAL* plugin
  <<
  Files: <<
    lib/%N/mod_useronline.so
    etc/%N/mods-available/useronline.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/useronline.conf
<<

SplitOff32: <<
  Package: lighttpd-deflate
  Depends: %N (=%v-%r)
  Description: Plugin: mod_deflate
  Replaces: lighttpd-compress (<< 1.4.56)
  Files: <<
    lib/%N/mod_deflate.so
    share/doc/%N/doc/compress.txt
    etc/%N/mods-available/deflate.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/compress.conf
<<

SplitOff33: <<
  Package: lighttpd-maxminddb
  Depends: %N (=%v-%r), libmaxminddb-shlibs
  Description: Plugin: mod_maxminddb
  Replaces: lighttpd-geoip (<< 1.4.54)
  Files: <<
    lib/%N/mod_maxminddb.so
    etc/%N/mods-available/maxminddb.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/maxminddb.conf
<<
