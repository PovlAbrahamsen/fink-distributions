Package: xemacs
# GDBM_COMPAT
Version: 21.4.24
Revision: 11
Epoch: 1
Description: Highly customizable text editor
Maintainer: None <fink-devel@lists.sourceforge.net>
License: GPL
Source: mirror:custom:stable/%n-%v.tar.bz2
Source-Checksum: SHA256(0274232e8481ec05f08920e53fece440418512f79ef13b4f6156bfc5399ed9e6)
#Source2: mirror:debian:pool/main/x/xemacs21/xemacs21_%v-12.debian.tar.xz
#Source2-Checksum: SHA256(f92f6a2804676bd72bed26678430f22b66dab8a5c4e3281daad94339a1e061fd)
PatchFile: %n.patch
PatchFile-MD5: 6dc94b681303e6c0c3f166e6e4858507
PatchFile2: %n-implicit-declaration.patch
PatchFile2-MD5: 6b2729aa49f413831ad9621865152d27
CustomMirror: <<
	A: http://ftp.xemacs.org/pub/xemacs/
	B: ftp://ftp.xemacs.org/pub/xemacs/
<<
PatchScript: <<
	%{default_script}
	# patch *ancient* darwin-ignorant autoconf
	perl -pi -e 's/(a so sl)/dylib \1/' configure
	# autoconf2.6ish patch for modern XQuartz paths
	perl -pi -e "s|/usr/lpp/Xamples|/opt/X11|" configure
	# Patch autoconf2.13 for direct x11 detection. See:
	# https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=327655
	perl -pi -e 's/x_direct_test_library=Xt/x_direct_test_library=X11/' configure
<<
BuildConflicts: libxt, libxt-flat
BuildDepends: <<
	compface-dev,
	fink (>= 0.32),
	fink-package-precedence (>= 0.34-1),
	fontconfig2-dev (>= 2.14.2-1),
	freetype219 (>= 2.12.1-4),
	gdbm4,
	libjpeg9,
	libncurses5 (>= 5.9-20110507-1),
	libpng16,
	libtiff6,
	libxaw3dxft (>= 1.6.2-7),
	system-xfree86-dev (>= 3:2.7.112-3),
	texinfo,
	xft2-dev (>= 2.2.0-5)
<<
Depends: <<
	compface-shlibs,
	gdbm4-shlibs,
	libjpeg9-shlibs,
	libncurses5-shlibs (>= 5.9-20110507-1),
	libpng16-shlibs,
	libtiff6-shlibs,
	libxaw3dxft-shlibs,
	ncurses (>= 5.9-20110507-1),
	system-xfree86 (>= 3:2.7.112-3),
	xemacs-base-pkg,
	xemacs-efs-pkg
<<
ConfigureParams: <<
	--with-dialogs=athena \
	--with-widgets=athena \
	--with-sound=none \
	--with-database=gdbm \
	--without-ldap \
	--without-postgresql \
	--with-athena=3d \
	--site-prefixes=%p
<<
SetCFLAGS: -O2 -g -std=c89
SetCPPFLAGS: -MD -I%p/include/freetype2
SetLDFLAGS: -Wl,-no_pie
CompileScript: <<
	./configure %c
	cp src/config.h src/config.h.orig
	sed -e '/GETPGRP_VOID/a\' -e '#define GETPGRP_VOID 1' src/config.h.orig > src/config.h
	make -w
	fink-package-precedence --depfile-ext='\.d' .
<<
InstallScript: <<
 make install prefix=%i mandir=%i/share/man/man1
 mv %i/bin/ctags %i/bin/ctags.xemacs
 mv %i/share/man/man1/ctags.1 %i/share/man/man1/ctags.1.xemacs
 mv %i/bin/etags %i/bin/etags.xemacs
 mv %i/share/man/man1/etags.1 %i/share/man/man1/etags.1.xemacs
 mv %i/bin/b2m %i/bin/b2m.xemacs
 mv %i/bin/rcs-checkin %i/bin/rcs-checkin.xemacs
 # Dump file doesn't need a hex identifier which changes from build to build
 mv %i/bin/xemacs-%v*.dmp %i/bin/xemacs-%v.dmp
<<
PostInstScript: <<
update-alternatives --install %p/bin/ctags ctags %p/bin/ctags.xemacs 60 --slave %p/share/man/man1/ctags.1 ctags.1 %p/share/man/man1/ctags.1.xemacs
update-alternatives --install %p/bin/etags etags %p/bin/etags.xemacs 80 --slave %p/share/man/man1/etags.1 etags.1 %p/share/man/man1/etags.1.xemacs
update-alternatives --install %p/bin/b2m b2m %p/bin/b2m.xemacs 80 
update-alternatives --install %p/bin/rcs-checkin rcs-checkin %p/bin/rcs-checkin.xemacs 80 
<<
PreRmScript: <<
if [ $1 != "upgrade" ]; then
  update-alternatives --remove ctags %p/bin/ctags.xemacs
  update-alternatives --remove etags %p/bin/etags.xemacs
  update-alternatives --remove b2m %p/bin/b2m.xemacs
  update-alternatives --remove rcs-checkin %p/bin/rcs-checkin.xemacs
fi
<<
DescPort: <<
o LDFLAGS: -Wl,-no_pie needed for 10.7 (nieder)
<<
Homepage: https://www.xemacs.org/
DescPackaging: <<
Patch missing sentinel in function call warnings.

xaw headers need ft headers, but xaw detection doesn't use .pc, so
doesn't learn special ft paths

Hopefully ensure libXt stability with versioned XQuartz dependency and avoid libxt*.

Hardcode finding ac_cv_getpgrp_void [getpgrp() takes no parameter]
because it's a really old configure and the AC_macro is broken these
days. Can't pass discovery in ./configure either because it's a really
old configure, so just edit config.h to say we found it.
<<
